<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ruleta con Sonido</title>
    <style>
        body { font-family: 'Segoe UI', sans-serif; display: flex; flex-direction: column; align-items: center; background-color: #1a1a1a; color: white; padding: 20px; }
        .main-container { display: flex; flex-wrap: wrap; gap: 30px; justify-content: center; margin-top: 20px; }
        .controls { background: #2d2d2d; padding: 25px; border-radius: 15px; box-shadow: 0 10px 30px rgba(0,0,0,0.5); width: 300px; }
        #canvas-container { position: relative; }
        .arrow { position: absolute; top: -10px; left: 50%; transform: translateX(-50%); width: 0; height: 0; border-left: 20px solid transparent; border-right: 20px solid transparent; border-top: 40px solid #ff4757; z-index: 10; filter: drop-shadow(0 2px 5px rgba(0,0,0,0.5)); }
        canvas { border: 8px solid #333; border-radius: 50%; background: white; box-shadow: 0 0 50px rgba(0,0,0,0.3); }
        textarea { width: 100%; height: 100px; margin: 15px 0; border-radius: 8px; border: none; padding: 10px; background: #444; color: white; font-size: 14px; }
        button { width: 100%; padding: 15px; cursor: pointer; border: none; border-radius: 8px; font-weight: bold; font-size: 16px; transition: 0.2s; text-transform: uppercase; }
        .btn-update { background: #3498db; color: white; margin-bottom: 10px; }
        .btn-spin { background: #2ecc71; color: white; box-shadow: 0 4px 0 #27ae60; }
        .btn-spin:active { transform: translateY(4px); box-shadow: none; }
        #resultado { margin-top: 20px; font-size: 1.4em; font-weight: bold; color: #f1c40f; text-align: center; min-height: 1.5em; }
    </style>
</head>
<body>
    <h1>ðŸŽ¡ Ruleta Pro con Sonido</h1>
    <div class="main-container">
        <div class="controls">
            <h3>ConfiguraciÃ³n</h3>
            <textarea id="listaPremios">Pizza, Tacos, Sushi, Cine, Viaje, Helado, Sorpresa, Ropa</textarea>
            <button class="btn-update" onclick="actualizar()">Actualizar Premios</button>
            <div id="resultado">Â¡Mucha suerte!</div>
        </div>
        <div id="canvas-container">
            <div class="arrow"></div>
            <canvas id="ruleta" width="450" height="450"></canvas>
            <button class="btn-spin" id="spinBtn" onclick="girar()">Â¡GIRAR!</button>
        </div>
    </div>

    <script>
        const canvas = document.getElementById('ruleta');
        const ctx = canvas.getContext('2d');
        let premios = [];
        let anguloActual = 0;
        const colores = ["#e74c3c", "#3498db", "#f1c40f", "#2ecc71", "#9b59b6", "#1abc9c", "#e67e22", "#34495e"];
        
        // --- FUNCIÃ“N DE SONIDO ---
        const audioCtx = new (window.AudioContext || window.webkitAudioContext)();
        function playTick() {
            const oscillator = audioCtx.createOscillator();
            const gainNode = audioCtx.createGain();
            oscillator.type = 'sine'; 
            oscillator.frequency.setValueAtTime(600, audioCtx.currentTime); 
            gainNode.gain.setValueAtTime(0.1, audioCtx.currentTime);
            gainNode.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + 0.1);
            oscillator.connect(gainNode);
            gainNode.connect(audioCtx.destination);
            oscillator.start();
            oscillator.stop(audioCtx.currentTime + 0.1);
        }

        function actualizar() {
            premios = document.getElementById('listaPremios').value.split(',').map(p => p.trim()).filter(p => p !== "");
            dibujar();
        }

        function dibujar(offset = 0) {
            const n = premios.length;
            const arco = (2 * Math.PI) / n;
            const cx = 225, cy = 225, r = 210;
            ctx.clearRect(0, 0, 450, 450);

            premios.forEach((premio, i) => {
                const ang = i * arco + offset;
                ctx.beginPath();
                ctx.fillStyle = colores[i % colores.length];
                ctx.moveTo(cx, cy);
                ctx.arc(cx, cy, r, ang, ang + arco);
                ctx.fill();
                ctx.strokeStyle = "white";
                ctx.lineWidth = 2;
                ctx.stroke();

                ctx.save();
                ctx.translate(cx, cy);
                ctx.rotate(ang + arco / 2);
                ctx.textAlign = "right";
                ctx.fillStyle = "white";
                ctx.font = "bold 16px Arial";
                ctx.fillText(premio, r - 30, 5);
                ctx.restore();
            });
        }

        function girar() {
            if (premios.length < 2) return alert("Pon al menos 2 premios");
            if (audioCtx.state === 'suspended') audioCtx.resume(); // Activar audio

            const btn = document.getElementById('spinBtn');
            btn.disabled = true;
            document.getElementById('resultado').innerText = "ðŸŒ€ Girando...";

            const extra = Math.random() * 4000 + 4000;
            const tiempo = 5000;
            const inicio = performance.now();
            let ultimoIndiceSonido = -1;

            function animar(ahora) {
                let progreso = (ahora - inicio) / tiempo;
                if (progreso > 1) progreso = 1;
                
                const easeOut = 1 - Math.pow(1 - progreso, 4);
                const anguloTotal = anguloActual + extra * easeOut;
                dibujar(anguloTotal);

                // --- LÃ“GICA DEL SONIDO ---
                const n = premios.length;
                const arco = (2 * Math.PI) / n;
                const indiceActual = Math.floor((anguloTotal % (2 * Math.PI)) / arco);
                
                if (indiceActual !== ultimoIndiceSonido) {
                    playTick(); // Suena cuando cambia de secciÃ³n
                    ultimoIndiceSonido = indiceActual;
                }

                if (progreso < 1) {
                    requestAnimationFrame(animar);
                } else {
                    anguloActual = anguloTotal % (2 * Math.PI);
                    btn.disabled = false;
                    const indiceFinal = Math.floor((2 * Math.PI - (anguloActual % (2 * Math.PI)) + (1.5 * Math.PI)) % (2 * Math.PI) / arco);
                    document.getElementById('resultado').innerText = "ðŸŽ‰ Â¡Ganaste: " + premios[indiceFinal] + "!";
                }
            }
            requestAnimationFrame(animar);
        }

        actualizar();
    </script>
</body>
</html>
