<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mi Ruleta Online</title>
    <style>
        body { font-family: sans-serif; display: flex; flex-direction: column; align-items: center; background-color: #f4f4f9; padding: 20px; }
        .main-container { display: flex; flex-wrap: wrap; gap: 30px; justify-content: center; }
        .controls { background: white; padding: 20px; border-radius: 10px; box-shadow: 0 4px 6px rgba(0,0,0,0.1); width: 280px; }
        #canvas-container { position: relative; }
        .arrow { position: absolute; top: -10px; left: 50%; transform: translateX(-50%); width: 0; height: 0; border-left: 15px solid transparent; border-right: 15px solid transparent; border-top: 30px solid red; z-index: 10; }
        canvas { border: 5px solid #333; border-radius: 50%; background: white; }
        textarea { width: 100%; height: 100px; margin: 10px 0; border: 1px solid #ccc; border-radius: 5px; padding: 5px; box-sizing: border-box; }
        button { width: 100%; padding: 10px; cursor: pointer; border: none; border-radius: 5px; font-weight: bold; transition: 0.3s; }
        .btn-update { background: #3498db; color: white; margin-bottom: 10px; }
        .btn-spin { background: #2ecc71; color: white; font-size: 1.2em; }
        button:disabled { background: #ccc; cursor: not-allowed; }
        #resultado { margin-top: 15px; font-size: 1.2em; font-weight: bold; color: #e74c3c; text-align: center; }
    </style>
</head>
<body>
    <h1>ðŸŽ¡ Ruleta de la Suerte</h1>
    <div class="main-container">
        <div class="controls">
            <h3>Premios</h3>
            <p><small>Separa cada premio con una coma (,)</small></p>
            <textarea id="listaPremios">Pizza, Tacos, Sushi, Cine, Regalo, Helado</textarea>
            <button class="btn-update" onclick="actualizar()">Actualizar Ruleta</button>
            <div id="resultado">Â¡Haz girar la ruleta!</div>
        </div>
        <div id="canvas-container">
            <div class="arrow"></div>
            <canvas id="ruleta" width="400" height="400"></canvas>
            <button class="btn-spin" id="spinBtn" onclick="girar()">Â¡GIRAR!</button>
        </div>
    </div>

    <script>
        const canvas = document.getElementById('ruleta');
        const ctx = canvas.getContext('2d');
        let premios = [];
        let anguloActual = 0;
        const colores = ["#FF5733", "#33FF57", "#3357FF", "#F333FF", "#FFB533", "#33FFF5", "#E67E22", "#9B59B6"];

        function actualizar() {
            premios = document.getElementById('listaPremios').value.split(',').map(p => p.trim()).filter(p => p !== "");
            dibujar();
        }

        function dibujar(offset = 0) {
            const n = premios.length;
            const arco = (2 * Math.PI) / n;
            const cx = 200, cy = 200, r = 190;
            ctx.clearRect(0, 0, 400, 400);

            premios.forEach((premio, i) => {
                const ang = i * arco + offset;
                ctx.beginPath();
                ctx.fillStyle = colores[i % colores.length];
                ctx.moveTo(cx, cy);
                ctx.arc(cx, cy, r, ang, ang + arco);
                ctx.fill();
                ctx.stroke();

                ctx.save();
                ctx.translate(cx, cy);
                ctx.rotate(ang + arco / 2);
                ctx.textAlign = "right";
                ctx.fillStyle = "black";
                ctx.font = "bold 14px Arial";
                ctx.fillText(premio, r - 20, 5);
                ctx.restore();
            });
        }

        function girar() {
            if (premios.length < 2) return alert("Pon al menos 2 premios");
            const btn = document.getElementById('spinBtn');
            btn.disabled = true;
            document.getElementById('resultado').innerText = "ðŸŒ€ Girando...";

            const extra = Math.random() * 3000 + 3000;
            const tiempo = 4000;
            const inicio = performance.now();

            function animar(ahora) {
                let progreso = (ahora - inicio) / tiempo;
                if (progreso > 1) progreso = 1;
                
                // Efecto de frenado suave
                const easeOut = 1 - Math.pow(1 - progreso, 3);
                const angulo = anguloActual + extra * easeOut;
                dibujar(angulo);

                if (progreso < 1) {
                    requestAnimationFrame(animar);
                } else {
                    anguloActual = angulo % (2 * Math.PI);
                    btn.disabled = false;
                    const n = premios.length;
                    const arco = (2 * Math.PI) / n;
                    // Flecha arriba es -90 grados (1.5 * PI)
                    const indice = Math.floor((2 * Math.PI - (anguloActual % (2 * Math.PI)) + (1.5 * Math.PI)) % (2 * Math.PI) / arco);
                    document.getElementById('resultado').innerText = "ðŸŽ‰ Â¡Ganaste: " + premios[indice] + "!";
                }
            }
            requestAnimationFrame(animar);
        }

        actualizar();
    </script>
</body>
</html>
